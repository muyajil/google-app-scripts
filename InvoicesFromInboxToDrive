{"files":[{"id":"29d56011-4ded-4166-8fac-bafbe74b610f","name":"Code","type":"server_js","source":"function InvoicesFromInboxToDrive() {\n    var newThreads \u003d GmailApp.search(\"is:unprocessed\");\n  \n    for(var i\u003d0; i \u003c newThreads.length; i++){\n        var messages \u003d newThreads[i].getMessages();\n        for(var j\u003d0; j \u003c messages.length; j++){\n            var message \u003d messages[j]\n            var body \u003d message.getBody();\n            var attachments \u003d message.getAttachments()\n            var attachment \u003d \"\";\n            if (attachments.length \u003e 0){\n                if (attachments[0].getName().indexOf(\".pdf\") !\u003d\u003d -1){\n                    attachment \u003d attachments[0];\n                }\n            }\n            var archiveFolderName \u003d Utilities.formatDate(new Date(), Session.getScriptTimeZone(), \"YYYY-MM\");\n            if (!DriveApp.getFoldersByName(archiveFolderName).hasNext()){\n              var parentFolder \u003d DriveApp.getFoldersByName(\u002701_invoices\u0027).next();\n              parentFolder.createFolder(archiveFolderName) \n            }\n            var archiveFolder \u003d DriveApp.getFoldersByName(archiveFolderName).next();\n            if (attachment !\u003d \"\"){\n                archiveFolder.createFile(attachment);\n            }\n            message.markRead();\n            GmailApp.starMessage(message)\n        }\n        var unprocessedLabel \u003d GmailApp.getUserLabelByName(\"unprocessed\");\n        var invoiceLabel \u003d GmailApp.getUserLabelByName(\"invoices\");\n        newThreads[i].removeLabel(unprocessedLabel);\n        newThreads[i].addLabel(invoiceLabel);\n    }\n}\n"},{"id":"ed18e2ef-1f71-4b74-a699-cc279d44777d","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Paris\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\"\n}"}]}